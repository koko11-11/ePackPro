<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Traçabilité Produits - Page 2</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* تنسيقات خاصة بالصفحة الثانية */
    .elements-list {
      padding: 1rem;
      flex-grow: 1;
      overflow-y: auto;
      background: var(--color-bg-page);
    }
    
    .element-item {
      background-color: var(--color-bg-card);
      border: 1px solid var(--color-border-card);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    .element-item:hover {
      background-color: var(--color-bg-card-hover);
      border-color: var(--color-focus);
    }
    
    .element-info {
      flex-grow: 1;
    }
    
    .element-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--color-text-primary);
    }
    
    .element-category {
      color: var(--color-text-muted);
      font-size: 0.9rem;
    }
    
    .element-dlc {
      background-color: #e8f5e8;
      color: #2e7d32;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--color-text-muted);
      font-style: italic;
    }
    
    /* تنسيقات النافذة المنبثقة */
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    #modal .modal-content {
      background-color: var(--color-bg-modal);
      padding: 1.5rem;
      width: 90%;
      max-width: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      position: relative;
    }
    
    #modal .modal-header {
      font-weight: bold;
      font-size: 1.25rem;
      color: var(--color-text-primary);
      text-align: center;
      margin-bottom: 0.5rem;
    }
    
    #modal label {
      font-size: 0.95rem;
      color: var(--color-text-primary);
      font-weight: 600;
      display: block;
      margin-bottom: 0.25rem;
    }
    
    #modal .dlc-section {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    
    #modal .dlc-section label {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
    }
    
    #modal .quantity-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: auto;
    }
    
    #modal .quantity-control button {
      background-color: var(--color-accent-green);
      color: white;
      border: none;
      width: 2rem;
      height: 2rem;
      font-size: 1.2rem;
      line-height: 1;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #modal .quantity-control button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    #modal .quantity-display {
      min-width: 2rem;
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
    }
    
    #modal .quantity-control span {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
      margin-left: 0.5rem;
    }
    
    #modal .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    #modal .modal-actions button {
      padding: 0.5rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      min-width: 90px;
    }
    
    #modal .cancel-btn {
      background-color: transparent;
      border: 2.5px solid var(--color-accent-red);
      color: var(--color-accent-red);
    }
    
    #modal .cancel-btn:hover {
      background-color: var(--color-accent-red);
      color: white;
    }
    
    #modal .submit-btn {
      background-color: var(--color-accent-green);
      color: white;
    }
    
    #modal .submit-btn:hover {
      background-color: var(--color-accent-green-dark);
    }
    
    #modal .close-icon {
      position: absolute;
      top: 0.5rem;
      right: 0.75rem;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--color-text-muted);
      user-select: none;
      background: none;
      border: none;
      padding: 0;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #modal .close-icon:hover {
      color: var(--color-text-primary);
    }
  </style>
</head>
<body>

  <!-- البار العلوي -->
  <header class="header">
    <button id="backToPage1" class="back-button" aria-label="Retour">&#8592;</button>
    <h1 class="page-title">TEMPERATURE DU CALM</h1>
  </header>

  <!-- محتوى الصفحة الثانية -->
  <main class="main-content">
    <div id="elementsContainer" class="elements-list">
      <div class="empty-state">Aucun élément trouvé</div>
    </div>
  </main>

  <!-- البار السفلي -->
  <div class="bottom-bar">
    <button id="ajouterElementBtn" class="btn-action"><i class="fas fa-plus"></i> Ajouter un élément</button>
    <button id="editerElementBtn" class="btn-action" disabled><i class="fas fa-edit"></i> Éditer un élément</button>
    
    <div class="search-container">
      <input type="search" aria-label="Rechercher" placeholder="Rechercher" id="searchInput" />
      <div class="search-icon"><i class="fas fa-search"></i></div>
    </div>
    
    <button id="terminerBtn" class="btn-terminer" disabled>J'ai terminé</button>
  </div>

  <!-- النافذة المنبثقة -->
  <div id="modal">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close-icon" id="modalClose">&times;</button>
      <div class="modal-header" id="modalTitle">Ajouter un élément</div>
      
      <div>
        <label for="elementName">Nom de l'élément</label>
        <input class="form-input" type="text" id="elementName" maxlength="255" placeholder="Entrez le nom" />
      </div>
      
      <div>
        <label for="elementCat">Catégories</label>
        <input class="form-input" type="text" id="elementCat" maxlength="255" placeholder="Entrez les catégories" />
      </div>
      
      <div class="dlc-section">
        <label>
          <input type="checkbox" id="dlcCheckbox" /> DLC
        </label>
        
        <div class="quantity-control">
          <button type="button" id="decrementBtn">−</button>
          <div class="quantity-display" id="quantityDisplay">3</div>
          <button type="button" id="incrementBtn">+</button>
          <span>Jour(s)</span>
        </div>
      </div>

      <div class="modal-actions">
        <button class="cancel-btn" id="cancelModalBtn">Annuler</button>
        <button class="submit-btn" id="submitModalBtn">Valider</button>
      </div>
    </div>
  </div>

<script>

  // المتغيرات
  const backToPage1 = document.getElementById('backToPage1');
  const elementsContainer = document.getElementById('elementsContainer');
  const ajouterElementBtn = document.getElementById('ajouterElementBtn');
  const editerElementBtn = document.getElementById('editerElementBtn');
  const searchInput = document.getElementById('searchInput');
  const terminerBtn = document.getElementById('terminerBtn');
  const modal = document.getElementById('modal');
  const modalClose = document.getElementById('modalClose');
  const cancelModalBtn = document.getElementById('cancelModalBtn');
  const submitModalBtn = document.getElementById('submitModalBtn');
  const elementNameInput = document.getElementById('elementName');
  const elementCatInput = document.getElementById('elementCat');
  const dlcCheckbox = document.getElementById('dlcCheckbox');
  const decrementBtn = document.getElementById('decrementBtn');
  const incrementBtn = document.getElementById('incrementBtn');
  const quantityDisplay = document.getElementById('quantityDisplay');

  // القيم الابتدائية
  let quantity = 3;
  let elements = [];
  let selectedElementId = null;
  let isEditing = false;

  // زر الرجوع للصفحة الأولى
backToPage1.addEventListener('click', () => {
  window.history.back();
});

  // عرض نافذة الإضافة
  ajouterElementBtn.addEventListener('click', () => {
    isEditing = false;
    document.getElementById('modalTitle').textContent = 'Ajouter un élément';
    openModal();
  });

  // عرض نافذة التعديل
  editerElementBtn.addEventListener('click', () => {
    if (selectedElementId === null) return;
    isEditing = true;
    document.getElementById('modalTitle').textContent = 'Éditer un élément';
    
    const element = elements.find(el => el.id === selectedElementId);
    if (element) {
      elementNameInput.value = element.name;
      elementCatInput.value = element.category || '';
      dlcCheckbox.checked = element.hasDlc || false;
      quantity = element.dlcDays || 3;
      updateQuantityDisplay();
    }
    
    openModal();
  });

  modalClose.addEventListener('click', closeModal);
  cancelModalBtn.addEventListener('click', closeModal);

  // التحكم بالعداد في الواجهة المنبثقة
  decrementBtn.addEventListener('click', () => {
    if (quantity > 0) {
      quantity--;
      updateQuantityDisplay();
    }
  });
  
  incrementBtn.addEventListener('click', () => {
    quantity++;
    updateQuantityDisplay();
  });

  function updateQuantityDisplay() {
    quantityDisplay.textContent = quantity;
    decrementBtn.disabled = quantity === 0;
  }

  // فتح وإغلاق النافذة
  function openModal() {
    if (!isEditing) {
      // إعادة تعيين القيم للنمط الجديد
      elementNameInput.value = '';
      elementCatInput.value = '';
      dlcCheckbox.checked = false;
      quantity = 3;
      updateQuantityDisplay();
    }
    modal.style.display = 'flex';
  }
  
  function closeModal() {
    modal.style.display = 'none';
    selectedElementId = null;
  }

  // تحديث حالة الأزرار بناءً على وجود عناصر
  function updateButtonsState() {
    const hasElements = elements.length > 0;
    editerElementBtn.disabled = !hasElements || selectedElementId === null;
    terminerBtn.disabled = !hasElements;
  }

  // عرض العناصر في القائمة
  function renderElements() {
    elementsContainer.innerHTML = '';
    
    if (elements.length === 0) {
      elementsContainer.innerHTML = '<div class="empty-state">Aucun élément trouvé</div>';
      return;
    }
    
    elements.forEach(element => {
      const elementDiv = document.createElement('div');
      elementDiv.className = 'element-item';
      if (element.id === selectedElementId) {
        elementDiv.style.borderColor = 'var(--color-focus)';
        elementDiv.style.backgroundColor = 'var(--color-bg-card-hover)';
      }
      
      elementDiv.innerHTML = `
        <div class="element-info">
          <div class="element-name">${element.name}</div>
          <div class="element-category">${element.category || 'Aucune catégorie'}</div>
        </div>
        ${element.hasDlc ? `<div class="element-dlc">${element.dlcDays} jour(s)</div>` : ''}
      `;
      
      elementDiv.addEventListener('click', () => {
        selectedElementId = element.id;
        renderElements();
        updateButtonsState();
      });
      
      elementsContainer.appendChild(elementDiv);
    });
  }

  // عند الضغط على زر Valider
  submitModalBtn.addEventListener('click', () => {
    const name = elementNameInput.value.trim();
    const cat = elementCatInput.value.trim();
    const hasDlc = dlcCheckbox.checked;

    if (!name) {
      alert("Veuillez entrer le nom de l'élément.");
      return;
    }

    if (isEditing && selectedElementId !== null) {
      // تعديل العنصر الموجود
      const elementIndex = elements.findIndex(el => el.id === selectedElementId);
      if (elementIndex !== -1) {
        elements[elementIndex] = {
          ...elements[elementIndex],
          name: name,
          category: cat,
          hasDlc: hasDlc,
          dlcDays: hasDlc ? quantity : 0
        };
      }
    } else {
      // إضافة عنصر جديد
      const newId = elements.length > 0 ? Math.max(...elements.map(el => el.id)) + 1 : 1;
      elements.push({
        id: newId,
        name: name,
        category: cat,
        hasDlc: hasDlc,
        dlcDays: hasDlc ? quantity : 0
      });
    }

    // تحديث واجهة المستخدم
    renderElements();
    updateButtonsState();

    // إغلاق النافذة بعد الإضافة/التعديل
    closeModal();
  });

  // البحث
  searchInput.addEventListener('input', () => {
    const searchTerm = searchInput.value.toLowerCase();
    if (searchTerm === '') {
      renderElements();
    } else {
      const filteredElements = elements.filter(el => 
        el.name.toLowerCase().includes(searchTerm) || 
        (el.category && el.category.toLowerCase().includes(searchTerm))
      );
      
      elementsContainer.innerHTML = '';
      
      if (filteredElements.length === 0) {
        elementsContainer.innerHTML = '<div class="empty-state">Aucun élément correspondant</div>';
      } else {
        filteredElements.forEach(element => {
          const elementDiv = document.createElement('div');
          elementDiv.className = 'element-item';
          
          elementDiv.innerHTML = `
            <div class="element-info">
              <div class="element-name">${element.name}</div>
              <div class="element-category">${element.category || 'Aucune catégorie'}</div>
            </div>
            ${element.hasDlc ? `<div class="element-dlc">${element.dlcDays} jour(s)</div>` : ''}
          `;
          
          elementsContainer.appendChild(elementDiv);
        });
      }
    }
  });

  // عند الضغط على زر الإنهاء
  terminerBtn.addEventListener('click', () => {
    alert('Opération terminée avec succès!');
    // يمكن هنا إضافة منطق لحفظ البيانات أو الانتقال إلى صفحة أخرى
  });

  // تهيئة أولية
  updateQuantityDisplay();
  updateButtonsState();
  renderElements();
</script>

</body>
</html>